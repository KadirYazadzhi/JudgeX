<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Export/Import LocalStorage</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>


<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Arial', sans-serif;
        background-color: #f7f8fa;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    /* Main button to open the modal */
    #open-modal {
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        background-color: #5c67f2;
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    #open-modal:hover {
        background-color: #4353d3;
    }

    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5); /* Black with opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 10px;
        width: 400px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Close button (X) */
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    /* Buttons inside the modal */
    #download-button, #upload-label {
        display: inline-block;
        padding: 15px 25px;
        font-size: 16px;
        font-weight: bold;
        color: white;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.2s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin: 15px 10px;
    }

    #download-button:hover, #upload-label:hover {
        background: linear-gradient(135deg, #764ba2, #667eea);
        transform: translateY(-3px);
    }

    #download-button:active, #upload-label:active {
        background: linear-gradient(135deg, #665abf, #7635ad);
    }

    #upload-input {
        display: none;
    }


</style>


<!-- Button to open the modal -->
<button id="open-modal">Open Settings</button>

<!-- The Modal -->
<div id="popup-modal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Storage Settings</h2>
        <!-- Button to download encrypted LocalStorage -->
        <button id="download-button">Download Encrypted LocalStorage</button>

        <!-- Input to upload and decrypt JSON file -->
        <label for="upload-input" id="upload-label">Upload Encrypted LocalStorage</label>
        <input type="file" id="upload-input" accept=".json">
    </div>
</div>

<script>
    const specialKey = "Fk93!dj#1ZlA09Qw7k&2Hn19E//*0la9012+:";

    const encryptionKey = specialKey;  // Replace with your own secure key

    // Function to encrypt data
    function encryptData(data) {
        return CryptoJS.AES.encrypt(data, encryptionKey).toString();
    }

    // Function to decrypt data
    function decryptData(encryptedData) {
        const bytes = CryptoJS.AES.decrypt(encryptedData, encryptionKey);
        return bytes.toString(CryptoJS.enc.Utf8);
    }

    // Function to download encrypted localStorage as a JSON file
    function downloadLocalStorage() {
        const allData = { ...localStorage };
        const jsonString = JSON.stringify(allData);
        const encryptedData = encryptData(jsonString);

        const blob = new Blob([encryptedData], { type: "application/json" });
        const link = document.createElement("a");
        link.download = "localStorageBackup_encrypted.json";
        link.href = URL.createObjectURL(blob);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Function to upload and decrypt localStorage from JSON file
    function uploadLocalStorage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const encryptedData = e.target.result;
                try {
                    const decryptedData = decryptData(encryptedData);
                    const data = JSON.parse(decryptedData);

                    for (let key in data) {
                        localStorage.setItem(key, data[key]);
                    }

                    alert("LocalStorage restored successfully!");
                } catch (error) {
                    alert("Decryption failed. Please ensure you are using the correct file and key.");
                }
            };
            reader.readAsText(file);
        }
    }

    // Attach event listeners to buttons
    document.getElementById('download-button').addEventListener('click', downloadLocalStorage);
    document.getElementById('upload-input').addEventListener('change', uploadLocalStorage);

</script>

<script>
    // Get modal element
    const modal = document.getElementById("popup-modal");

    // Get button that opens the modal
    const openModalBtn = document.getElementById("open-modal");

    // Get the <span> element that closes the modal
    const closeModalBtn = document.querySelector(".close");

    // Open the modal when the button is clicked
    openModalBtn.onclick = function() {
        modal.style.display = "block";
    }

    // Close the modal when the user clicks on <span> (x)
    closeModalBtn.onclick = function() {
        modal.style.display = "none";
    }

    // Close the modal if the user clicks anywhere outside of the modal
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

</script>
</body>
</html>
